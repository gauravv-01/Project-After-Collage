var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _FloatingItem=_interopRequireDefault(require("../FloatingItem"));var _constants=require("../../constants");var _helpers=require("../../helpers");var _styles=_interopRequireDefault(require("../../styles"));var _styles2=_interopRequireDefault(require("./styles"));var _jsxFileName="/Users/nicotroia/PROJECTS/react-native-floating-action-menu/src/components/FloatingMenu/index.js";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}var FloatingMenu=function(_React$PureComponent){(0,_inherits2.default)(FloatingMenu,_React$PureComponent);var _super=_createSuper(FloatingMenu);function FloatingMenu(){var _this;(0,_classCallCheck2.default)(this,FloatingMenu);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={dimmerActive:false,menuButtonDown:false,itemsDown:{},items:[],buttonWidth:0,innerWidth:0};_this.menuPressAnimation=new _reactNative.Animated.Value(0);_this.itemPressAnimations={};_this.itemFanAnimations={};_this.dimmerTimeout=null;_this.initAnimations=function(){var items=_this.state.items;if(!_this.menuPressAnimation)_this.menuPressAnimation=new _reactNative.Animated.Value(0);for(var i=0;i<items.length;i++){if(!_this.itemPressAnimations[i]){_this.itemPressAnimations[i]=new _reactNative.Animated.Value(0);}if(i<items.length&&!_this.itemFanAnimations[i]){_this.itemFanAnimations[i]=new _reactNative.Animated.Value(0);}}};_this.handleItemPressIn=function(index,animatedValue){var useNativeDriver=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return function(){_reactNative.Animated.timing(animatedValue,{toValue:1.0,duration:14,useNativeDriver:useNativeDriver}).start();if(index===null){_this.setState({menuButtonDown:true});}else{_this.setState({itemsDown:_objectSpread(_objectSpread({},_this.state.itemsDown),{},(0,_defineProperty2.default)({},index,true))});}};};_this.handleItemPressOut=function(index,animatedValue){var useNativeDriver=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return function(){_reactNative.Animated.timing(animatedValue,{toValue:0.0,duration:142,useNativeDriver:useNativeDriver}).start();if(index===null){_this.setState({menuButtonDown:false});}else{_this.setState({itemsDown:_objectSpread(_objectSpread({},_this.state.itemsDown),{},(0,_defineProperty2.default)({},index,false))});}};};_this.handleItemPress=function(index){return function(){var onItemPress=_this.props.onItemPress;var items=_this.state.items;var item=items[index];if(!item)return;if(item.onPress){item.onPress(item,index);}else if(onItemPress){onItemPress(item,index);}};};_this.handleMenuPress=function(){var _this$props=_this.props,isOpen=_this$props.isOpen,onMenuToggle=_this$props.onMenuToggle;onMenuToggle(!isOpen);};_this.toggleMenu=function(isOpen){var _this$props2=_this.props,openEase=_this$props2.openEase,closeEase=_this$props2.closeEase;var items=_this.state.items;var options={toValue:isOpen?1.0:0.0,duration:142-Math.max(items.length-2,0)*5,tension:30,friction:5,useNativeDriver:true};var totalDelay=0;var _loop=function _loop(i){var t=(isOpen?i:items.length-i-1)/items.length;var ease=isOpen?openEase(t):closeEase(t);var time=150/Math.min(Math.max(items.length,0),8)*i+160;var delay=Math.max(Math.min(time*ease,300),0);totalDelay=delay+time;_reactNative.Animated.delay(delay).start(function(){_reactNative.Animated.spring(_this.itemFanAnimations[i],options).start();});};for(var i=0;i<items.length;i++){_loop(i);}_this.dimmerTimeout&&clearTimeout(_this.dimmerTimeout);if(isOpen){_this.setState({dimmerActive:true});}else{_this.dimmerTimeout=setTimeout(function(){_this.setState({dimmerActive:false});},totalDelay);}};_this.renderItems=function(){var _this$props3=_this.props,isOpen=_this$props3.isOpen,position=_this$props3.position,renderItemIcon=_this$props3.renderItemIcon,backgroundUpColor=_this$props3.backgroundUpColor,backgroundDownColor=_this$props3.backgroundDownColor,borderColor=_this$props3.borderColor,iconColor=_this$props3.iconColor,primaryColor=_this$props3.primaryColor;var _this$state=_this.state,items=_this$state.items,itemsDown=_this$state.itemsDown,dimmerActive=_this$state.dimmerActive,buttonWidth=_this$state.buttonWidth,innerWidth=_this$state.innerWidth;if(!dimmerActive)return null;return items.map(function(item,index){if(!item)return null;return _react.default.createElement(_FloatingItem.default,(0,_extends2.default)({key:"item-"+index},item,{item:item,index:index,icon:renderItemIcon?renderItemIcon(item,index,_objectSpread({},_this.state)):null,position:position,isOpen:isOpen||dimmerActive,backgroundUpColor:backgroundUpColor,backgroundDownColor:backgroundDownColor,borderColor:borderColor,iconColor:iconColor,primaryColor:primaryColor,buttonWidth:buttonWidth,innerWidth:innerWidth,numItems:items.length,itemsDown:itemsDown,itemFanAnimations:_this.itemFanAnimations,itemPressAnimations:_this.itemPressAnimations,onPress:_this.handleItemPress(index),onPressIn:_this.handleItemPressIn(index,_this.itemPressAnimations[index]),onPressOut:_this.handleItemPressOut(index,_this.itemPressAnimations[index]),__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:191,columnNumber:9}}));});};_this.renderMenuButton=function(){var _this$props4=_this.props,renderMenuIcon=_this$props4.renderMenuIcon,isOpen=_this$props4.isOpen,backgroundUpColor=_this$props4.backgroundUpColor,backgroundDownColor=_this$props4.backgroundDownColor,_borderColor=_this$props4.borderColor,_iconColor=_this$props4.iconColor,primaryColor=_this$props4.primaryColor,buttonOuterStyle=_this$props4.buttonOuterStyle,buttonTouchableStyle=_this$props4.buttonTouchableStyle,buttonInnerStyle=_this$props4.buttonInnerStyle;var _this$state2=_this.state,menuButtonDown=_this$state2.menuButtonDown,buttonWidth=_this$state2.buttonWidth,innerWidth=_this$state2.innerWidth;var iconColor=_iconColor||primaryColor;var borderColor=_borderColor||primaryColor;var backgroundColor=_this.menuPressAnimation.interpolate({inputRange:[0.0,1.0],outputRange:[backgroundUpColor||'#ffffff',backgroundDownColor||primaryColor]});var content=renderMenuIcon?renderMenuIcon(_objectSpread({},_this.state)):_react.default.createElement(_reactNative.Text,{style:[_styles.default.missingIcon,isOpen?_styles2.default.closeIcon:_styles2.default.menuIcon,{color:menuButtonDown?'#fff':iconColor}],__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:256,columnNumber:7}},isOpen?'×':'☰');return _react.default.createElement(_reactNative.View,{style:[_styles.default.buttonOuter,(0,_helpers.applyButtonWidth)(buttonWidth),{borderColor:borderColor,marginTop:buttonWidth*0.3},buttonOuterStyle],__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:270,columnNumber:7}},_react.default.createElement(_reactNative.TouchableWithoutFeedback,{style:[_styles.default.button,buttonTouchableStyle],onPressIn:_this.handleItemPressIn(null,_this.menuPressAnimation),onPressOut:_this.handleItemPressOut(null,_this.menuPressAnimation),onPress:_this.handleMenuPress,hitSlop:{top:10,left:10,right:10,bottom:10},__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:278,columnNumber:9}},_react.default.createElement(_reactNative.Animated.View,{style:[_styles.default.buttonInner,(0,_helpers.applyButtonWidth)(innerWidth),{backgroundColor:backgroundColor},buttonInnerStyle],__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:285,columnNumber:11}},content)));};_this.renderDimmer=function(){var _this$props5=_this.props,isOpen=_this$props5.isOpen,dimmerStyle=_this$props5.dimmerStyle;var _this$state3=_this.state,items=_this$state3.items,dimmerActive=_this$state3.dimmerActive;var fanAnimation=_this.itemFanAnimations[0];var opacity=fanAnimation&&fanAnimation.interpolate({inputRange:[0.0,1.0],outputRange:[0.5,1.0],extrapolate:'clamp'});return dimmerActive&&items.length?_react.default.createElement(_reactNative.TouchableWithoutFeedback,{disabled:!isOpen,onPress:_this.handleMenuPress,__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:314,columnNumber:7}},_react.default.createElement(_reactNative.Animated.View,{style:[_styles.default.dimmer,_styles2.default.dimmer,{opacity:opacity},dimmerStyle],__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:318,columnNumber:9}})):null;};_this.render=function(){var _ref;var _this$props6=_this.props,position=_this$props6.position,top=_this$props6.top,left=_this$props6.left,right=_this$props6.right,bottom=_this$props6.bottom,containerStyle=_this$props6.containerStyle,itemContainerStyle=_this$props6.itemContainerStyle;var buttonWidth=_this.state.buttonWidth;var _position$split=position.split('-'),_position$split2=(0,_slicedToArray2.default)(_position$split,2),vPos=_position$split2[0],hPos=_position$split2[1];var vVal=vPos==='top'?top||38:vPos==='bottom'?bottom||38:38;var hVal=hPos==='left'?left||38:hPos==='right'?right||38:38;return _react.default.createElement(_reactNative.View,{style:[_styles2.default.container,containerStyle],pointerEvents:"box-none",__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:344,columnNumber:7}},_react.default.createElement(_reactNative.View,{style:[_styles2.default.itemContainer,(_ref={width:buttonWidth,minHeight:buttonWidth},(0,_defineProperty2.default)(_ref,vPos,vVal),(0,_defineProperty2.default)(_ref,hPos,hVal),(0,_defineProperty2.default)(_ref,"flexDirection",vPos.toLowerCase()==='bottom'?'column':'column-reverse'),_ref),itemContainerStyle],pointerEvents:"box-none",__self:(0,_assertThisInitialized2.default)(_this),__source:{fileName:_jsxFileName,lineNumber:345,columnNumber:9}},_this.renderItems(),_this.renderMenuButton()),_this.renderDimmer());};return _this;}(0,_createClass2.default)(FloatingMenu,[{key:"componentDidMount",value:function componentDidMount(){this.initAnimations();}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var isOpen=this.props.isOpen;var items=this.state.items;if(prevProps.items.length!==items.length){this.initAnimations();}if(prevProps.isOpen&&!isOpen){this.toggleMenu(false);}else if(!prevProps.isOpen&&isOpen){this.toggleMenu(true);}}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){var items=nextProps.items,buttonWidth=nextProps.buttonWidth,innerWidth=nextProps.innerWidth;return _objectSpread(_objectSpread({},prevState),{},{items:(0,_toConsumableArray2.default)(items).reverse(),buttonWidth:buttonWidth||(0,_helpers.getButtonWidth)(),innerWidth:innerWidth||(0,_helpers.getButtonWidth)()*0.8});}}]);return FloatingMenu;}(_react.default.PureComponent);FloatingMenu.defaultProps={items:[],primaryColor:_constants.Colors.primaryColor,position:_constants.MenuPositions.bottomRight,openEase:function openEase(t){return--t*t*t+1;},closeEase:function closeEase(t){return t*t*t;},top:38,left:38,right:38,bottom:38,containerStyle:{},itemContainerStyle:{},buttonOuterStyle:{},buttonTouchableStyle:{},buttonInnerStyle:{}};var _default=FloatingMenu;exports.default=_default;